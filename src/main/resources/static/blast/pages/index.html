<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Upload</title>
    <style>
        /*根节点html字体大小*/
        html{
            font-size:12px;
        }
        body {
            background-color: #f7f6f2 ; /*#f7f6f2  #d5d5d5*/
            /* 针对web元素塌陷*/
            min-width: 65rem;
            max-width: 130rem;
            margin: 0 auto;
        }
        /* 针对设备自适应自适应*/
        #app{
            width: 106rem;
            margin: 0 auto;
            box-shadow: 2rem 2rem 1rem #888888;
        }
        /* 手机 宽度小于768px的 */
        @media only screen and (max-width: 768px) {
            #app {
                width: 100%;
            }
        }
        /* 平板 宽度大于768px的*/
        @media only screen and (min-width: 768px) {
            #app {
                width: 62rem;
            }
        }
        /* 电脑 */
        @media only screen and (min-width: 992px) {
            #app {
                width: 80rem;
            }
        }
        /* web 更宽的屏幕 */
        @media only screen and (min-width: 1200px) {
            #app {
                width: 97rem;
            }
        }

        .el-header, .el-footer {
            background-color: #20558a;
            color: #333;
            text-align: justify; /*设置文字 两端分布*/
            line-height: 2rem;
        }

        /* 设置页头下元素属性*/
        .el-header > p {
            font-size: 140%;
            color: whitesmoke;
            font-family: Calibri, sans-serif
        }

        /* 设置页脚下元素属性*/
        .el-footer > div {
            font-size: 140%;
            color: whitesmoke;
            font-family: Calibri, sans-serif;
            text-align: center;
        }

        .el-aside {
            background-color: #E9EEF3;
            color: #333;
            text-align: center;
        }

        #el-form {
            margin-left: 0;
        }

        .el-main {
            background-color: #E9EEF3;
            color: #333;
            text-align: center;
        }

        /*设置导航栏的字体格式*/
        .el-menu-demo > .el-menu-item {
            font-family: Helvetica, sans-serif;
            font-size: 120%;
            font-weight: bold;
        }

        /*设置进度条的字体*/
        .el-steps > .el-step {
            font-family: Arial, sans-serif;
            font-size: 120%;
            font-weight: bold;
        }

        /*走马灯设置 item和主盒子要一起设置宽高*/
        /* 控制外面的大盒子*/
        .el-carousel__container {
            height: 40rem !important;
            width: 80rem;
        }
        .el-carousel{
            height: 43rem;
            width: 80rem;
            margin-left: 5.5rem;
        }
        /*下面的指示灯*/
        .el-carousel__indicators--horizontal {
            position: absolute;
            left: auto;
            right: 10px;
            bottom: 10px;
            text-align: right;
        }
        .el-carousel__indicator--horizontal button {
            width: 8px;
            height: 8px;
            background: #41555f;
            border-radius: 50%;
            opacity: 0.5;
        }
        .el-carousel__indicator--horizontal.is-active button {
            width: 24px;
            height: 8px;
            background: #ffffff;
            opacity: 0.5;
            border-radius: 10px;
        }
        /*小标题 图标*/
        .el-carousel__item h3 {
            color: #ffffff;
            font-size: 2rem;
            opacity: 1;
            /*line-height: 3rem;*/
        }
        /*修改幻灯片的小箭头大小*/
        .el-carousel__arrow i{
            font-size: 2rem;
            width: 2rem;
        }

        /*幻灯片的图片 单双设置*/
        .el-carousel__item:nth-child(2n) {
            height: 40rem;
            background-image: url("https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fs41467-018-04369-4/MediaObjects/41467_2018_4369_Fig1_HTML.jpg?as=webp"); /**/
            background-size: 100%;
        }

        .el-carousel__item:nth-child(2n+1) {
            height: 40rem;
            background-image: url("https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fs41467-018-04369-4/MediaObjects/41467_2018_4369_Fig3_HTML.jpg?as=webp");
            background-size: 100%;
        }

        /*标题*/
        .demo{
            font-size: 2rem;
            margin-top: 1rem;
            margin-bottom: 1rem;
            color: #565c65;
            font-family: "Arial",sans-serif;

            -webkit-animation: tracking-in-expand 0.7s cubic-bezier(0.215, 0.610, 0.355, 1.000) both;
            animation: tracking-in-expand 0.7s cubic-bezier(0.215, 0.610, 0.355, 1.000) both;
        }
        /*标题的动画*/
        @-webkit-keyframes tracking-in-expand {
            0% {
                letter-spacing: -0.5em;
                opacity: 0;
            }
            40% {
                opacity: 0.6;
            }
            100% {
                opacity: 1;
            }
        }
        @keyframes tracking-in-expand {
            0% {
                letter-spacing: -0.5em;
                opacity: 0;
            }
            40% {
                opacity: 0.6;
            }
            100% {
                opacity: 1;
            }
        }
        /*下一步按钮*/
        .next-button{
            font-family: "Comic Sans MS",serif;
            font-size: 20px;
            font-weight: bold;
            background-color: #20558a;
            width: 15rem;
            height: 4rem;
        }
        /*下载区域*/
        .upload1{
            border-style: dotted;
            border-color: #a5aeb6;
            border-width: 3px;
            background-color: #d3dee3;
            margin-left: 5rem;
            margin-right: 2rem;
            padding-bottom: 4rem;

            font-size: 2rem;
        }
        .upload2{
            border-style: dotted;
            border-color: #a5aeb6;
            border-width: 3px;
            background-color: #d3dee3;
            margin-right: 5rem;
            margin-left: 2rem;
            padding-bottom: 4rem;

            font-size: 2rem;
        }
        /*ele container setting*/
        body > .el-container {
            margin-bottom: 5rem;
        }

        .el-container:nth-child(5) .el-aside,
        .el-container:nth-child(6) .el-aside {
            line-height: 30rem;
        }

        .el-container:nth-child(7) .el-aside {
            line-height: 50rem;
        }
    </style>
</head>
<body>
<div id="app">
    <!--General Part-->
    <!--使用container布局-->
    <el-container>
        <!--1 页头 图标-->
        <img src="../imgs/header.jpg" alt="heads" width="100%"/>

        <!--2 导航栏-->
        <el-header style="background-color: white">
            <!-- :default-active v-bind为html属性绑定值，代表当前激活的bar索引-->
            <el-menu :default-active="activeBar" class="el-menu-demo"
                     mode="horizontal" @select="handleSelect">
                <el-menu-item index="1" onclick="document.location.href='index.html'">Home</el-menu-item>
                <el-menu-item index="4" onclick="document.location.href='contact.html'">Contact Us</el-menu-item>
            </el-menu>
        </el-header>

        <!--3 介绍语-->
        <el-header style="height: 10rem;">
            <p>
                <em style="font-size: 2rem; color: #beff72;">Step1: Upload the sequence. </em>The Basic Local Alignment Search Tool (BLAST) finds regions of local similarity between sequences. The
                program compares nucleotide or protein sequences to sequence databases and calculates the statistical
                significance of matches. BLAST can be used to infer functional and evolutionary relationships between
                sequences as well as help identify members of gene families.
            </p>
        </el-header>

        <!--4 进度条-->
        <el-header style="background: white; height: 140%">
            <!--:active v-bind绑定的属性 显示目前进度索引-->
            <el-steps :active="activeStep" align-center style="padding-top: 2rem; padding-bottom: 2rem">
                <el-step title="Step 1 Upload" icon="el-icon-upload"
                         description="upload your file"></el-step>
                <el-step title="Step 2 Setting" icon="el-icon-edit"
                         description="Set the parameters"></el-step>
                <el-step title="Step 3 Tuning" icon="el-icon-refresh-right"
                         description="Repeatedly adjust fine tuning"></el-step>
                <el-step title="Step 4 Download" icon="el-icon-download"
                         description="Download the required files"></el-step>
            </el-steps>
        </el-header>
    </el-container>

    <!--5 走马灯-->
    <el-container>
        <el-main>
            <!-- 一个走马灯流程 可以展示你们程序的过程-->
            <span class="demonstration">
                    <h4 class="demo">- The WorkFlow of Quartat Blast Model -</h4>
            </span>
            <el-carousel indicator-position="outside">
                <el-carousel-item v-for="item in 4" :key="item">
                    <h3 class="small">{{ item }}</h3>
                </el-carousel-item>
            </el-carousel>
        </el-main>
    </el-container>

    <!--6 上传文件-->
    <el-container>
            <el-aside width="50%">
                <div class="upload1">
                    <!-- 功能提示 -->
                    <el-popover
                            style="font-size: 2rem"
                            placement="top-start"
                            title="Reference Genome File:"
                            width="300"
                            trigger="hover"
                            content="It automatically determines the format of the input.
                                     To allow this feature, certain conventions are required
                                     with regard to the input of identifiers.">
                        <el-button
                                slot="reference"
                                style="margin-bottom: 5%;
                                       margin-top: 5%;
                                font-size: 1.5rem">
                            Upload Reference Genome
                        </el-button>
                    </el-popover>
                    <!--测试请求地址：https://jsonplaceholder.typicode.com/posts/
                        实际请求地址：/blast/common/uploadGenome-->
                    <el-upload
                            class="upload-demo"
                            drag
                            action="/blast/common/uploadGenome"
                            :on-success="handleUploadSuccess"
                            :on-remove="handleRemove"
                            :before-remove="beforeRemove"
                            :before-upload="beforeUpload"
                            :on-exceed="handleExceed"
                            :file-list="fileList"
                            :show-file-list="true"
                            :limit="1"
                            ref="upload">
                        <i class="el-icon-upload"></i>
                        <div class="el-upload__text"
                             style="font-size: 1.5rem">
                            Drag your file here, or
                            <em>click to upload</em>
                        </div>
                        <div class="el-upload__tip"
                             slot="tip"
                             style="font-size: 1.5rem">
                            Reference Genome File (FASTA format)
                        </div>
                    </el-upload>
                </div>
            </el-aside>

            <el-aside width="50%">
                <div class="upload2">
                    <!-- 功能提示 -->
                    <el-popover
                            placement="top-start"
                            title="HiFi Contigs or Scaffolds"
                            width="300"
                            trigger="hover"
                            content="HiFi reads are produced using circular consensus sequencing (CCS)
                                     mode on PacBio long-read systems. HiFi reads provide base-level
                                     resolution with 99.9% single-molecule read accuracy.">
                        <el-button slot="reference"
                                   style="margin-bottom: 5%;
                                          margin-top: 5%;
                                          font-size: 1.5rem">
                            Upload HiFi Contigs or Scaffolds
                        </el-button>
                    </el-popover>
                    <el-upload
                            class="upload-demo"
                            drag
                            action="/blast/common/uploadHiFi"
                            :on-success="handleUploadSuccess2"
                            :on-remove="handleRemove2"
                            :before-remove="beforeRemove2"
                            :before-upload="beforeUpload2"
                            :on-exceed="handleExceed2"
                            :file-list="fileList"
                            :show-file-list="true"
                            :limit="1"
                            ref="upload">
                        <i class="el-icon-upload"></i>
                        <div class="el-upload__text"
                             style="font-size: 1.5rem">
                            Drag your file here, or
                            <em>click to upload</em>
                        </div>
                        <div class="el-upload__tip"
                             slot="tip"
                             style="font-size: 1.5rem">
                            Hi-Fi Assembled Contigs or Scaffolds File (FASTA format)
                        </div>
                    </el-upload>
                </div>
            </el-aside>
    </el-container>

    <!--7 下一步按钮-->
    <el-container>
        <el-main>
            <span >
                 <el-button class="next-button"
                            style="font-size: 1.5rem"
                            type="primary"
                            @click="onRedirect">
                     Next Step
                 </el-button>
            </span>
        </el-main>
    </el-container>

    <!--8 页脚信息-->
    <el-footer style="height: 120%;">
        <div>
            &nbsp;&nbsp;&nbsp;&nbsp;XXX, Professor
            <br>
            &nbsp;&nbsp;&nbsp;&nbsp;State Key Laboratory of Tea Plant Biology and Utilization
            <br>
            Anhui Agricultural University, Hefei 230036, China.
            <br>
            &nbsp;&nbsp;&nbsp;&nbsp;Email: yechen@ahau.edu.cn
            <br>
            &nbsp;&nbsp;&nbsp;&nbsp;Tel/Fax: +86 (0551)888 8888
        </div>
    </el-footer>
</div>
</body>

<!-- 引入组件库 -->
<!--改为cdn引入-->
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script>
    // import fa from "../element-ui/src/locale/lang/fa";

    new Vue({
        el: `#app`,
        data: function () {
            return {
                activeBar: "1", // 导航栏激活的栏，默认为Home
                activeStep: 0, // 设置step的激活值 默认为0 意味着step1正在进行中
                uploadSeqFile: 0,
                uploadHiFiFile: 0
            }
        },

        // TODO new 用户离开页面 提示内容未保存
        beforeDestroy(){
            alert("Are you sure to leave? Your data will be missing!")
        },

        methods: {
            /* 上传文件的钩子函数*/

            /* TODO 1 文件列表只允许上传一个文件*/
            handleExceed(files, fileList) {
                this.$message.error(`Limit ONE File Only, You Have To Remove the Current File!`);
            },
            /* TODO 2 文件的后缀和大小限制*/
            beforeUpload(file) {
                let filename = file.name.toString();
                console.log(filename);
                let suffix = filename.substring(filename.indexOf(".")+1);
                console.log(suffix);
                let suffixList = ["fasta", "fas", "fa", "FASTA", "FA", "FAS"];

                let isFas = (suffixList.indexOf(suffix) !== -1);
                let isLt2M = file.size / 1024 / 1024 < 2;
                // 后缀判断
                if (!isFas) {
                    this.$message.error('The File Format Must Be .FASTA, .FAS or .FA!');
                }else if(!isLt2M){  // 后缀正确 判断大小
                    this.$message.error('File Size Must be Less Than 2MB!');
                }
                /*if (!isLt2M) {
                    this.$message.error('File Size Must be Less Than 2MB!');
                }*/
                console.log(isFas && isLt2M);
                return isFas && isLt2M;
            },
             // TODO 3 文件的移除
            beforeRemove(file, fileList) {
                if (file && file.status === "success") {
                    //移除方法
                    return this.$confirm(`Are You Confirm to Remove ${ file.name }？`,'(＃°Д°)',{
                        confirmButtonText:'Yes',
                        cancelButtonText:'No',
                        type:'error'
                    });
                }
            },
            // 删除后 重新设置
            handleRemove(file, fileList) {
                if (file && file.status === "success") {
                    this.uploadSeqFile = 0;
                    this.activeStep = 0;
                    this.$message.info("Removed Successfully");
                }
            },
            // 上传成功提示
            handleUploadSuccess(){
                this.$message.success("Upload Successfully");
                this.uploadSeqFile = 1;
                /* 如果HiFi文件也上传成功了 */
                if(this.uploadHiFiFile === 1){
                    this.activeStep = 1
                }
            },

            handleExceed2(files, fileList) {
                this.$message.error(`Limit ONE File Only, You Have To Remove the Current File!`);
            },
            /* TODO 2 文件的后缀和规格限制*/
            beforeUpload2(file) {
                let filename = file.name.toString();
                console.log(filename);
                let suffix = filename.substring(filename.indexOf(".")+1);
                console.log(suffix);
                let suffixList = ["fasta", "fas", "fa", "FASTA", "FA", "FAS"];

                let isFas = (suffixList.indexOf(suffix) !== -1);
                let isLt2M = file.size / 1024 / 1024 < 2;
                // 后缀判断
                if (!isFas) {
                    this.$message.error('The File Format Must Be .FASTA, .FAS or .FA!');
                }else if(!isLt2M){  // 后缀正确 判断大小
                    this.$message.error('File Size Must be Less Than 2MB!');
                }
                /*if (!isLt2M) {
                    this.$message.error('File Size Must be Less Than 2MB!');
                }*/
                console.log(isFas && isLt2M);
                return isFas && isLt2M;
            },
            // TODO 3 文件的移除
            beforeRemove2(file, fileList) {
                if (file && file.status === "success") {
                    //移除方法
                    return this.$confirm(`Are You Confirm to Remove ${ file.name }？`,'Σ(っ °Д °;)っ',{
                        confirmButtonText:'Yes',
                        cancelButtonText:'No',
                        type:'warning'
                    });
                }
            },
            // 删除后 重新设置
            handleRemove2(file, fileList) {
                if (file && file.status === "success") {
                    this.uploadHiFiFile = 0;
                    this.activeStep = 0;
                    this.$message.info("Removed Successfully");
                }
            },
            // 上传成功提示
            handleUploadSuccess2(){
                this.$message.success("Upload Successfully");
                this.uploadHiFiFile = 1;
                if(this.uploadSeqFile === 1){
                    this.activeStep = 1;
                }
            },

            // 网页跳转
            onRedirect(){
                if(this.activeStep === 0){
                    this.$message.error("Please Upload Your File First !")
                }else {
                    document.location.href = "setting.html";
                }
            },
        }

    });
</script>
</html>